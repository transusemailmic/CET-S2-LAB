-- Database and Table Creation

CREATE DATABASE UNIVERSITY;
USE UNIVERSITY;

CREATE TABLE STUDENT (
    Name VARCHAR(50),
    Student_number INT PRIMARY KEY,
    Class INT,
    Major VARCHAR(50)
);

CREATE TABLE COURSE (
    Course_name VARCHAR(100),
    Course_number VARCHAR(10) PRIMARY KEY,
    Credit_hours INT,
    Department VARCHAR(50)
);

CREATE TABLE SECTION (
    Section_identifier INT PRIMARY KEY,
    Course_number VARCHAR(10),
    Semester VARCHAR(10),
    Year INT,
    Instructor VARCHAR(50),
    FOREIGN KEY (Course_number) REFERENCES COURSE(Course_number)
);

CREATE TABLE GRADE_REPORT (
    Student_number INT,
    Section_identifier INT,
    Grade CHAR(2),
    PRIMARY KEY (Student_number, Section_identifier),
    FOREIGN KEY (Student_number) REFERENCES STUDENT(Student_number),
    FOREIGN KEY (Section_identifier) REFERENCES SECTION(Section_identifier)
);

CREATE TABLE PREREQUISITE (
    Course_number VARCHAR(10),
    Prerequisite_number VARCHAR(10),
    PRIMARY KEY (Course_number, Prerequisite_number),
    FOREIGN KEY (Course_number) REFERENCES COURSE(Course_number),
    FOREIGN KEY (Prerequisite_number) REFERENCES COURSE(Course_number)
);


-- Inserting Values to Tables

INSERT INTO STUDENT VALUES
('Smith',17,1,'CS'),
('Brown',8,2,'CS');

INSERT INTO COURSE VALUES
('Intro to Computer Science','CS1310',4,'CS'),
('Data Structures','CS3320',4,'CS'),
('Discrete Mathematics','MATH2410',3,'MATH'),
('Database','CS3380',3,'CS');

INSERT INTO SECTION VALUES
(85,'MATH2410','Fall',2007,'King'),
(92,'CS1310','Fall',2007,'Anderson'),
(102,'CS3320','Spring',2008,'Knuth'),
(112,'MATH2410','Fall',2008,'Chang'),
(119,'CS1310','Fall',2008,'Anderson'),
(135,'CS3380','Fall',2008,'Stone');

INSERT INTO GRADE_REPORT VALUES
(17,112,'B'),
(17,119,'C'),
(8,85,'A'),
(8,92,'A'),
(8,102,'B'),
(8,135,'A');

INSERT INTO PREREQUISITE VALUES
('CS3380','CS3320'),
('CS3380','MATH2410'),
('CS3320','CS1310');


-- Selection of Data

SELECT C.Course_name, G.Grade
FROM STUDENT S
JOIN GRADE_REPORT G ON S.Student_number = G.Student_number
JOIN SECTION SE ON G.Section_identifier = SE.Section_identifier
JOIN COURSE C ON SE.Course_number = C.Course_number
WHERE S.Name = 'Smith';


SELECT student.name, grade_report.grade
FROM student JOIN grade_report ON student.student_number=grade_report.student_number
JOIN section ON section.section_identifier=grade_report.section_identifier
JOIN course ON course.course_number=section.course_number
WHERE course.course_name='Database' AND section.semester='Fall' AND section.year=2008;

SELECT prerequisite.prerequisite_number FROM prerequisite JOIN course ON prerequisite.course_number=course.course_number WHERE course.course_name='Database';


SELECT name FROM student WHERE major='CS' AND class=2; 


SELECT course.course_name FROM course JOIN section ON course.course_number=section.course_number WHERE section.instructor='King' AND section.year IN (2007,2008);


SELECT course.course_name FROM course JOIN section ON course.course_number=section.course_number WHERE section.instructor='King' AND (section.year=2007 OR section.year=2008);



SELECT course.course_number, section.semester, section.year, COUNT(student.name) AS number_of_students 
FROM student JOIN grade_report ON student.student_number=grade_report.student_number
JOIN section ON section.section_identifier=grade_report.section_identifier
JOIN course ON course.course_number=section.course_number
WHERE section.instructor='King'
GROUP BY course.course_number, section.semester, section.year;


SELECT student.name, course.course_name, course.course_number, course.credit_hours, section.semester, section.year, grade_report.grade
FROM student JOIN grade_report ON student.student_number=grade_report.student_number
JOIN section ON section.section_identifier=grade_report.section_identifier
JOIN course ON course.course_number=section.course_number
WHERE student.major='CS' AND student.class=2;







